!function(){"use strict";!function e(){if("loading"===document.readyState)return document.addEventListener("DOMContentLoaded",e);var t={minDistance:150,maxTime:300,time:0,posX:0,posY:0},n=parseInt((window.location.search.match(/wi=(\d+)/)||["",0])[1]);function o(e){if(!document.querySelector(".webcomic-gestures, [data-webcomic-gestures]"))return document.documentElement.removeEventListener("touchstart",o,!1),void document.documentElement.removeEventListener("touchend",i);t.time=(new Date).getTime(),t.posX=e.changedTouches[0].pageX,t.posY=e.changedTouches[0].pageY}function i(e){var n=document.querySelector(".webcomic-gestures, [data-webcomic-gestures]"),c=(new Date).getTime()-t.time,a=e.changedTouches[0].pageX-t.posX,d=e.changedTouches[0].pageY-t.posY,s="Arrow";if(!n)return document.documentElement.removeEventListener("touchstart",o,!1),void document.documentElement.removeEventListener("touchend",i);c>t.maxTime||(Math.abs(a)>=t.minDistance&&Math.abs(d)<t.minDistance?(s+="Right",0<a&&(s=s.replace("Right","Left"))):Math.abs(d)>=t.minDistance&&Math.abs(a)<t.minDistance&&(s+="Down",0<d&&(s=s.replace("Down","Up"))),"Arrow"!==s&&(1<e.changedTouches.length&&(s+="Shift"),r(s,n)))}function r(e,t){var n=t.querySelector("."+{ArrowDownShift:"random-webcomic-link",ArrowLeft:"previous-webcomic-link",ArrowLeftShift:"first-webcomic-link",ArrowRight:"next-webcomic-link",ArrowRightShift:"last-webcomic-link",ArrowUpShift:"webcomic-print-link"}[e]+"[href]");e&&t&&n&&n.dispatchEvent(new MouseEvent("click",{bubbles:!0,cancelable:!0}))}window.addEventListener("scroll",function e(){var t=document.querySelector(".webcomic-infinite, [data-webcomic-infinite]");if(!t)return void window.removeEventListener("scroll",e);if(t.classList.contains("loading"))return;var o=t.children[t.children.length-1];if(o&&o.getBoundingClientRect().top+window.scrollY>window.scrollY+window.innerHeight)return;if(t.querySelector("wbr.finished"))return void window.removeEventListener("scroll",e);t.classList.add("loading");var i=parseInt(t.children.length)+n,r=new FormData,c=new XMLHttpRequest;var a=window.location.href.replace(/wi=\d+/,"wi="+i);window.location.search||(a=window.location.href+"?wi="+i);r.append("action","webcomic_infinite");r.append("url",window.location.href);r.append("args","offset="+i+"&"+t.getAttribute("data-webcomic-infinite"));c.onreadystatechange=function(){4===c.readyState&&(t.innerHTML+=c.responseText,t.classList.remove("loading"),history.replaceState({},"",a))};c.open("POST",webcomicCommonJS.ajaxurl);c.send(r)}),document.addEventListener("change",function(e){if("select"!==e.target.tagName.toLowerCase()||!e.target.options[e.target.selectedIndex].getAttribute("data-webcomic-url"))return;var t=e.target.options[e.target.selectedIndex].getAttribute("data-webcomic-url");if(t===window.location.href)return;window.location.href=t}),document.addEventListener("keyup",function(e){if(e.target.tagName.toLowerCase().match(/button|input|meter|option|output|progress|select|textarea/))return;var t=document.querySelector(".webcomic-keyboard, [data-webcomic-shortcuts]"),n=e.key;if(!t)return;e.shiftKey&&(n+="Shift");r(n,t)}),document.addEventListener("click",function(e){var t=document.querySelectorAll(".webcomic-dynamic");if(!t.length)return;var n=e.target;for(;n.tagName&&!n.classList.contains("webcomic-link");)n=n.parentNode;if(!n.tagName)return;e.preventDefault();var o=new FormData,i=new XMLHttpRequest;o.append("action","webcomic_dynamic"),i.onreadystatechange=function(){if(4===i.readyState){var e=document.createElement("div");e.innerHTML=i.responseText;var o=e.querySelectorAll(".webcomic-dynamic");if(o.length)for(var r=0;r<t.length;r++)t[r].parentNode.replaceChild(o[r],t[r]);else window.location.href=n.href}},i.open("POST",n.href),i.send(o)}),document.documentElement.addEventListener("touchstart",o,!1),document.documentElement.addEventListener("touchend",i),window.dispatchEvent(new Event("scroll"))}()}();
